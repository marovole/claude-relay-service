# Claude Relay Service éƒ¨ç½²æŒ‡å—

## ğŸ“‹ å½“å‰çŠ¶æ€

âœ… **Docker é•œåƒå·²æˆåŠŸæ„å»ºå¹¶æ¨é€åˆ° Docker Hub**
- é•œåƒåç§°: `marovole000/claude-relay-service:latest`
- ä¼˜åŒ–ç‰¹æ€§: åŒ…å« Node.js å†…å­˜ä¼˜åŒ– (`--max-old-space-size=1024`)

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ–¹æ³• 1ï¼šä½¿ç”¨è‡ªåŠ¨éƒ¨ç½²è„šæœ¬ï¼ˆæ¨èï¼‰

å¦‚æœæ‚¨çš„æœåŠ¡å™¨å·²æ¢å¤åœ¨çº¿ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
cd /opt/claude-relay-service
bash scripts/deploy-prebuilt.sh
```

è¿™ä¸ªè„šæœ¬ä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
1. âœ… åœæ­¢ç°æœ‰å®¹å™¨
2. âœ… æ¸…ç†æ—§å‡­è¯æ•°æ®
3. âœ… ä» Docker Hub æ‹‰å–é¢„æ„å»ºé•œåƒ
4. âœ… å¯åŠ¨å®¹å™¨
5. âœ… éªŒè¯æœåŠ¡çŠ¶æ€

### æ–¹æ³• 2ï¼šæ‰‹åŠ¨éƒ¨ç½²æ­¥éª¤

å¦‚æœæ‚¨éœ€è¦æ‰‹åŠ¨éƒ¨ç½²ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /opt/claude-relay-service

# 2. åœæ­¢ç°æœ‰å®¹å™¨ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
docker-compose down

# 3. æ¸…ç†æ—§å‡­è¯æ–‡ä»¶
rm -f data/init.json

# 4. ä» Docker Hub æ‹‰å–é•œåƒï¼ˆä¸éœ€è¦æœ¬åœ°æ„å»ºï¼‰
docker-compose pull

# 5. å¯åŠ¨å®¹å™¨
docker-compose up -d

# 6. ç­‰å¾…å®¹å™¨å¯åŠ¨
sleep 5

# 7. æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose ps

# 8. æŸ¥çœ‹æ—¥å¿—ï¼ˆå®æ—¶ï¼‰
docker-compose logs -f
```

## ğŸ” ç¯å¢ƒé…ç½®

### æ£€æŸ¥ .env æ–‡ä»¶

ç¡®ä¿æ‚¨çš„ `.env` æ–‡ä»¶åŒ…å«ä»¥ä¸‹å¿…è¦é…ç½®ï¼š

```bash
# å¿…å¡«é¡¹
JWT_SECRET=your-secret-key-min-32-chars-here
ENCRYPTION_KEY=your-encryption-key-32-chars

# ç®¡ç†å‘˜å‡­è¯ï¼ˆå¿…å¡«ï¼‰
ADMIN_USERNAME=admin
ADMIN_PASSWORD=admin123456

# Redis é…ç½®ï¼ˆå¯é€‰ï¼Œå·²åœ¨ docker-compose.yml ä¸­é…ç½®ï¼‰
REDIS_PASSWORD=

# Claude API é…ç½®ï¼ˆå¯é€‰ï¼‰
CLAUDE_API_URL=https://api.anthropic.com/v1/messages
CLAUDE_API_VERSION=2023-06-01
```

### ç”Ÿæˆå¯†é’¥ï¼ˆå¦‚æœéœ€è¦ï¼‰

å¦‚æœæ‚¨éœ€è¦ç”Ÿæˆæ–°çš„ JWT_SECRET å’Œ ENCRYPTION_KEYï¼š

```bash
# ç”Ÿæˆ JWT_SECRETï¼ˆè‡³å°‘ 32 å­—ç¬¦ï¼‰
openssl rand -base64 24 | tr -d '\n'

# ç”Ÿæˆ ENCRYPTION_KEYï¼ˆæ°å¥½ 32 å­—ç¬¦ï¼‰
openssl rand -hex 16
```

## âœ… éªŒè¯éƒ¨ç½²

éƒ¨ç½²å®Œæˆåï¼Œè¯·éªŒè¯ä»¥ä¸‹é¡¹ç›®ï¼š

### 1. æ£€æŸ¥å®¹å™¨çŠ¶æ€

```bash
docker-compose ps
```

åº”è¯¥çœ‹åˆ° `claude-relay` å’Œ `redis` å®¹å™¨éƒ½åœ¨è¿è¡ŒçŠ¶æ€ `Up`ã€‚

### 2. æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€

```bash
curl http://localhost:3000/health
```

åº”è¯¥è¿”å›æˆåŠŸçš„å“åº”ã€‚

### 3. è®¿é—®ç®¡ç†åå°

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š
```
http://your-server-ip:3000/admin-next/
```

### 4. ç™»å½•ç®¡ç†åå°

ä½¿ç”¨ä»¥ä¸‹å‡­è¯ç™»å½•ï¼š
- **ç”¨æˆ·å**: `admin`
- **å¯†ç **: `admin123456`

ï¼ˆå¦‚æœæ‚¨åœ¨ .env ä¸­é…ç½®äº†ä¸åŒçš„å‡­è¯ï¼Œè¯·ä½¿ç”¨é‚£äº›å‡­è¯ï¼‰

## ğŸ”§ å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜ 1: å®¹å™¨æ— æ³•å¯åŠ¨

**ç—‡çŠ¶**: `docker-compose up -d` åå®¹å™¨æœªè¿è¡Œ

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
docker-compose logs claude-relay

# æ£€æŸ¥æ—¥å¿—æ–‡ä»¶
tail -f data/logs/*.log

# ç¡®ä¿ .env æ–‡ä»¶å­˜åœ¨ä¸”æœ‰æ•ˆ
cat .env
```

### é—®é¢˜ 2: ç®¡ç†åå°æ— æ³•è®¿é—®

**ç—‡çŠ¶**: æ— æ³•è®¿é—® `http://server-ip:3000/admin-next/`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥å®¹å™¨æ˜¯å¦è¿è¡Œ
docker-compose ps

# æ£€æŸ¥ç«¯å£æ˜¯å¦å¼€æ”¾
netstat -tlnp | grep 3000

# æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
sudo ufw status
```

### é—®é¢˜ 3: ç™»å½•å¤±è´¥

**ç—‡çŠ¶**: è¾“å…¥æ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç ä½†æ— æ³•ç™»å½•

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ¸…é™¤æ—§çš„åˆå§‹åŒ–æ•°æ®
rm -f data/init.json

# é‡å¯å®¹å™¨
docker-compose restart claude-relay

# ç­‰å¾… 5 ç§’åé‡æ–°å°è¯•ç™»å½•
sleep 5
```

## ğŸ“Š Docker é•œåƒä¿¡æ¯

### æ„å»ºä¿¡æ¯

- **åŸºç¡€é•œåƒ**: `node:18-alpine`
- **å‰ç«¯æ„å»º**: Vite + Vue.js
- **Node.js å †é™åˆ¶**: 1024MBï¼ˆä¼˜åŒ–ä»¥é€‚åº”ä½å†…å­˜æœåŠ¡å™¨ï¼‰
- **æ„å»ºæ—¶é—´**: ~7-8 ç§’ï¼ˆæœ¬åœ° macOSï¼‰

### é•œåƒå¤§å°

å¤§çº¦ 500-600 MBï¼ˆåŒ…å«æ‰€æœ‰ä¾èµ–å’Œå‰ç«¯æ„å»ºäº§ç‰©ï¼‰

## ğŸ”„ æ›´æ–°é•œåƒ

å¦‚æœä»£ç æœ‰æ›´æ–°ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ›´æ–°é•œåƒï¼š

```bash
# æ‹‰å–æœ€æ–°é•œåƒ
docker pull marovole000/claude-relay-service:latest

# åœæ­¢å¹¶é‡å¯å®¹å™¨
docker-compose down
docker-compose up -d
```

## ğŸ“ æ—¥å¿—ç®¡ç†

### æŸ¥çœ‹å®æ—¶æ—¥å¿—

```bash
# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨æ—¥å¿—
docker-compose logs -f

# ä»…æŸ¥çœ‹ claude-relay å®¹å™¨æ—¥å¿—
docker-compose logs -f claude-relay

# æŸ¥çœ‹æœ€å 50 è¡Œæ—¥å¿—
docker-compose logs --tail=50
```

### æœ¬åœ°æ—¥å¿—æ–‡ä»¶

æ—¥å¿—ä¹Ÿä¼šä¿å­˜åœ¨ä»¥ä¸‹ä½ç½®ï¼š
```
/opt/claude-relay-service/logs/
```

## ğŸ†˜ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœéƒ¨ç½²å‡ºç°é—®é¢˜ï¼Œè¯·ï¼š

1. æ£€æŸ¥å®¹å™¨æ—¥å¿—: `docker-compose logs`
2. éªŒè¯ .env æ–‡ä»¶é…ç½®
3. ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´
4. æŸ¥çœ‹æœ¬æŒ‡å—ä¸­çš„ã€Œå¸¸è§é—®é¢˜è§£å†³ã€éƒ¨åˆ†

## ğŸ“Œ å…³é”®ä¿¡æ¯æ€»ç»“

| é¡¹ç›® | å€¼ |
|------|-----|
| æœåŠ¡åœ°å€ | http://your-ip:3000 |
| ç®¡ç†åå° | http://your-ip:3000/admin-next/ |
| API ç«¯ç‚¹ | http://your-ip:3000/api/v1/messages |
| å¥åº·æ£€æŸ¥ | http://your-ip:3000/health |
| Docker Hub é•œåƒ | marovole000/claude-relay-service:latest |
| é»˜è®¤ç”¨æˆ·å | admin |
| é»˜è®¤å¯†ç  | admin123456 |

---

âœ… **éƒ¨ç½²å·²å‡†å¤‡å°±ç»ªï¼** ä¸€æ—¦æ‚¨çš„æœåŠ¡å™¨åœ¨çº¿ï¼Œè¯·è¿è¡Œéƒ¨ç½²è„šæœ¬ã€‚
